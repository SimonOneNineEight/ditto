<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>6</storyId>
    <title>Timeline View Enhancements - Filters and Date Ranges</title>
    <status>drafted</status>
    <generatedAt>2026-02-08</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/4-6-timeline-view-enhancements-filters-and-date-ranges.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>job seeker</asA>
    <iWant>enhanced filtering and view options on the timeline</iWant>
    <soThat>I can focus on what's most relevant right now</soThat>
    <tasks>
      <task id="1" title="Create Backend Timeline API Enhancement" acs="1,2,4,7">
        <subtask id="1.1">Update backend/internal/handlers/timeline_handler.go to accept filter params: ?type=interviews|assessments|all&amp;range=today|week|month|all</subtask>
        <subtask id="1.2">Add date grouping logic: calculate date_group field (today, tomorrow, this_week, later) based on due/scheduled date</subtask>
        <subtask id="1.3">Ensure overdue items are sorted first in results</subtask>
        <subtask id="1.4">Update GET /api/timeline response to include date_group field per item</subtask>
      </task>
      <task id="2" title="Create Frontend Timeline Service Update" acs="1,2,5">
        <subtask id="2.1">Update frontend/src/services/timeline-service.ts to accept filter parameters</subtask>
        <subtask id="2.2">Add TypeScript types for timeline filter options in frontend/src/types/timeline.ts</subtask>
      </task>
      <task id="3" title="Create TimelineFilters Component" acs="1,2,3">
        <subtask id="3.1">Create frontend/src/app/(app)/timeline/components/TimelineFilters.tsx</subtask>
        <subtask id="3.2">Implement type filter chips: All (active by default), Interviews, Assessments</subtask>
        <subtask id="3.3">Implement time range filter chips: Today, This Week, This Month, All Upcoming</subtask>
        <subtask id="3.4">Follow chip styling from Upcoming widget (ditto-design.pen filter chips pattern)</subtask>
        <subtask id="3.5">Active chip: $--primary fill, $--primary-foreground text</subtask>
        <subtask id="3.6">Inactive chip: transparent, $--border stroke, $--muted-foreground text</subtask>
      </task>
      <task id="4" title="Create TimelineItem Component with Color Coding" acs="3,6,7">
        <subtask id="4.1">Create frontend/src/app/(app)/timeline/components/TimelineItem.tsx</subtask>
        <subtask id="4.2">Add color coding: Interviews (blue/$--primary), Assessments (orange/$--accent), Overdue (red/#7f1d1d)</subtask>
        <subtask id="4.3">Display: icon, company name, event title, date/time, countdown badge</subtask>
        <subtask id="4.4">Implement click handler to navigate to detail page (interview or assessment)</subtask>
        <subtask id="4.5">Use urgency colors from Upcoming widget: overdue (dark red), tomorrow (secondary), soon (accent), normal (border)</subtask>
      </task>
      <task id="5" title="Create TimelineDateGroup Component" acs="4">
        <subtask id="5.1">Create frontend/src/app/(app)/timeline/components/TimelineDateGroup.tsx</subtask>
        <subtask id="5.2">Display date group header: Today, Tomorrow, This Week, Later</subtask>
        <subtask id="5.3">Group items by date_group from API response</subtask>
        <subtask id="5.4">Style headers: 14px, font-weight 600, $--muted-foreground</subtask>
      </task>
      <task id="6" title="Create Timeline Page with Filters and Grouping" acs="1,2,4,5,6,7">
        <subtask id="6.1">Create frontend/src/app/(app)/timeline/page.tsx (new page - does not exist yet)</subtask>
        <subtask id="6.2">Add PageHeader with title Timeline and subtitle</subtask>
        <subtask id="6.3">Integrate TimelineFilters component above timeline list</subtask>
        <subtask id="6.4">Use URL query parameters for filter state: ?type=interviews&amp;range=week</subtask>
        <subtask id="6.5">Parse query params on page load to restore filter state</subtask>
        <subtask id="6.6">Update URL on filter change without page reload (useRouter)</subtask>
        <subtask id="6.7">Render TimelineDateGroup components with grouped items</subtask>
        <subtask id="6.8">Add empty state when no events match filters</subtask>
      </task>
      <task id="7" title="Implement Filter Persistence and URL State" acs="5">
        <subtask id="7.1">Create custom hook useTimelineFilters for filter state management</subtask>
        <subtask id="7.2">Sync filter state with URL query params using Next.js router</subtask>
        <subtask id="7.3">Persist filter defaults (All type, All Upcoming range)</subtask>
      </task>
      <task id="8" title="Add Timeline to Sidebar Navigation" acs="8">
        <subtask id="8.1">Update frontend/src/components/sidebar/sidebar.tsx</subtask>
        <subtask id="8.2">Add Timeline entry with Calendar icon between Interviews and Files</subtask>
        <subtask id="8.3">URL: /timeline</subtask>
      </task>
      <task id="9" title="Add View all Link to Upcoming Widget" acs="9">
        <subtask id="9.1">Update frontend/src/app/(app)/dashboard/components/UpcomingWidget.tsx</subtask>
        <subtask id="9.2">Change View applications link to View all pointing to /timeline</subtask>
        <subtask id="9.3">Position link in header row, right-aligned</subtask>
      </task>
      <task id="10" title="Testing and Accessibility" acs="1,2,3,4,5,6,8,9">
        <subtask id="10.1">Manual test: filters correctly update timeline items</subtask>
        <subtask id="10.2">Manual test: date grouping shows correct headers</subtask>
        <subtask id="10.3">Manual test: color coding matches type and urgency</subtask>
        <subtask id="10.4">Manual test: URL updates on filter change and restores on page refresh</subtask>
        <subtask id="10.5">Manual test: sidebar navigation works and highlights active state</subtask>
        <subtask id="10.6">Manual test: View all link from dashboard navigates to timeline</subtask>
        <subtask id="10.7">Keyboard navigation: filter chips focusable, Enter activates</subtask>
        <subtask id="10.8">Screen reader: aria-labels on filter chips, aria-current for active</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">Type filter available - I can filter timeline by: Type (All / Interviews / Assessments)</ac>
    <ac id="2">Time range filter available - I can filter timeline by: Time range (Today / This Week / This Month / All Upcoming)</ac>
    <ac id="3">Events color-coded by type - Interviews display in blue, Assessments in orange, Overdue items in red</ac>
    <ac id="4">Events sorted chronologically with date grouping - Events are grouped under headers: Today, Tomorrow, This Week, Later</ac>
    <ac id="5">Filter selections persist in URL - Filter state is stored in URL query params for shareability/bookmarking</ac>
    <ac id="6">Click event navigates to detail - Clicking any event navigates to its detail page</ac>
    <ac id="7">Overdue items highlighted at top - Overdue items appear first with red highlighting</ac>
    <ac id="8">Timeline accessible from sidebar - Timeline navigation entry added to sidebar between Interviews and Files</ac>
    <ac id="9">Timeline accessible from dashboard - View all link in Upcoming widget navigates to /timeline</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec-epic-4.md" title="Epic 4 Technical Specification" section="Story 4.6: Timeline View Enhancements">
        Timeline backend enhancement with TimelineFilters struct (Type: all/interviews/assessments, Range: today/week/month/all), TimelineItem with DateGroup field. Date grouping: today, tomorrow, this_week, later.
      </doc>
      <doc path="docs/architecture.md" title="Architecture Document" section="API Contracts - Timeline Endpoints">
        GET /api/timeline returns upcoming interviews + assessments merged and sorted. Pagination with offset-based pattern (?page=1&amp;per_page=20). Date format: ISO 8601 strings.
      </doc>
      <doc path="docs/architecture.md" title="Architecture Document" section="Implementation Patterns">
        API endpoints: /api/{resource}/{id?}/{action?}. Frontend service pattern with apiClient calls. Error handling with toast for action errors.
      </doc>
      <doc path="docs/epics.md" title="Epics Document" section="Story 4.6">
        Timeline View Enhancements - Filters and Date Ranges. Filter by type (All/Interviews/Assessments), filter by time range, date grouping headers, URL-persistent filter state.
      </doc>
    </docs>

    <code>
      <file path="backend/internal/handlers/dashboard_handler.go" kind="handler" symbol="GetUpcomingItems" lines="37-59" reason="Contains existing type filter logic (?type=all|interviews|assessments). Reuse same filter validation pattern for timeline handler."/>
      <file path="backend/internal/repository/dashboard_repository.go" kind="repository" symbol="GetUpcomingItems" lines="167-286" reason="SQL UNION pattern for interviews + assessments. Contains calculateCountdown helper and buildItemLink. DateGroup calculation should extend this pattern."/>
      <file path="backend/internal/repository/dashboard_repository.go" kind="repository" symbol="calculateCountdown" lines="293-328" reason="Urgency calculation logic (overdue, today, upcoming, scheduled). Extend with date_group calculation (today, tomorrow, this_week, later)."/>
      <file path="frontend/src/app/(app)/dashboard/components/UpcomingWidget.tsx" kind="component" symbol="UpcomingWidget" lines="1-118" reason="Filter chip pattern for type filter (all/interviews/assessments). Reuse chip styling: rounded-full, px-3 py-1.5, bg-primary/text-primary-foreground for active."/>
      <file path="frontend/src/app/(app)/dashboard/components/UpcomingItemCard.tsx" kind="component" symbol="UpcomingItemCard" lines="1-97" reason="4-level urgency styles (overdue, today, upcoming, scheduled). Type badge pattern (interview blue, assessment accent). Reuse urgencyStyles object."/>
      <file path="frontend/src/services/dashboard-service.ts" kind="service" symbol="getUpcomingItems" lines="25-36" reason="API call pattern with URLSearchParams. Extend for timeline-service with type and range filters."/>
      <file path="frontend/src/types/upcoming.ts" kind="types" symbol="UpcomingItem, UpcomingFilterType" lines="1-22" reason="Base types for timeline items. Extend for TimelineFilterType and TimelineRangeFilter."/>
      <file path="frontend/src/components/notification-center/index.ts" kind="barrel" symbol="exports" lines="1-13" reason="Barrel export pattern for component directory. Use same pattern for timeline/components/index.ts."/>
      <file path="frontend/src/components/sidebar/sidebar.tsx" kind="component" symbol="sidebarMenu" lines="28-49" reason="Sidebar navigation menu array. Add Timeline entry between Interviews and Files."/>
    </code>

    <dependencies>
      <node>
        <package name="next" version="14.2.15">App Router, useRouter, useSearchParams for URL state</package>
        <package name="date-fns" version="^4.1.0">Date formatting, startOfWeek, endOfWeek calculations</package>
        <package name="lucide-react" version="^0.452.0">Calendar and Code icons for timeline items</package>
        <package name="clsx" version="^2.1.1">Conditional class names for urgency styling</package>
        <package name="tailwind-merge" version="^2.5.3">Merge tailwind classes via cn() utility</package>
      </node>
      <go>
        <package name="github.com/gin-gonic/gin" version="v1.10.1">HTTP router, query param binding</package>
        <package name="github.com/google/uuid" version="v1.6.0">UUID handling for IDs</package>
        <package name="github.com/jmoiron/sqlx" version="v1.4.0">SQL query execution with struct scanning</package>
      </go>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="important">Timeline page does NOT exist yet - create from scratch at frontend/src/app/(app)/timeline/page.tsx</constraint>
    <constraint type="pattern">Follow handler/repository pattern - create timeline_handler.go, reuse GetUpcomingItems logic from dashboard_repository</constraint>
    <constraint type="pattern">Frontend components in app/(app)/timeline/components/ with barrel export index.ts</constraint>
    <constraint type="pattern">Use Next.js useSearchParams hook for URL query param state</constraint>
    <constraint type="performance">API response target: &lt;500ms (NFR-1.2)</constraint>
    <constraint type="pagination">Limit items per page: 20, use offset-based pagination</constraint>
    <constraint type="accessibility">Filter chips must be keyboard accessible (Tab, Enter) with aria-pressed</constraint>
    <constraint type="styling">Reuse urgency colors from UpcomingItemCard - do not create new color schemes</constraint>
  </constraints>

  <interfaces>
    <interface name="GET /api/timeline" kind="REST endpoint">
      <signature>GET /api/timeline?type=all|interviews|assessments&amp;range=today|week|month|all&amp;page=1&amp;per_page=20</signature>
      <path>backend/internal/handlers/timeline_handler.go (to be created/modified)</path>
    </interface>
    <interface name="TimelineItem" kind="Go struct">
      <signature>type TimelineItem struct { ID uuid.UUID; Type string; Title string; CompanyName string; JobTitle string; DueDate time.Time; Countdown CountdownInfo; DateGroup string; Link string }</signature>
      <path>backend/internal/repository/dashboard_repository.go:139-156 (extend UpcomingItem)</path>
    </interface>
    <interface name="UpcomingItem" kind="TypeScript interface">
      <signature>interface UpcomingItem { id: string; type: 'interview' | 'assessment'; title: string; company_name: string; job_title: string; due_date: string; countdown: CountdownInfo; link: string; }</signature>
      <path>frontend/src/types/upcoming.ts:9-19</path>
    </interface>
    <interface name="getUpcomingItems" kind="frontend service function">
      <signature>async function getUpcomingItems(limit: number, type: UpcomingFilterType): Promise&lt;UpcomingItem[]&gt;</signature>
      <path>frontend/src/services/dashboard-service.ts:25-36</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Manual testing for UI. Unit tests deferred per Story 4-5 review findings (no working test DB setup). Follow existing test patterns in backend/internal/repository/dashboard_test.go for any repository tests. Frontend follows integration test pattern where feasible.
    </standards>
    <locations>
      <location>backend/internal/repository/dashboard_test.go</location>
      <location>backend/internal/handlers/ (handler tests if added)</location>
    </locations>
    <ideas>
      <idea ac="1">Test type filter: all returns both types, interviews returns only interviews, assessments returns only assessments</idea>
      <idea ac="2">Test range filter: today returns same-day items, week returns items within 7 days, month within 30 days</idea>
      <idea ac="4">Test date grouping: items correctly categorized as today/tomorrow/this_week/later based on due_date</idea>
      <idea ac="7">Test overdue sorting: items with past due_date appear before future items regardless of filter</idea>
      <idea ac="5">Test URL persistence: filter params in URL survive page refresh and correctly restore filter state</idea>
      <idea ac="8">Test sidebar navigation: Timeline link appears between Interviews and Files, navigates to /timeline, highlights when active</idea>
      <idea ac="9">Test View all link: clicking link in Upcoming widget navigates to /timeline page</idea>
    </ideas>
  </tests>
</story-context>
