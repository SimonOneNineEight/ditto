<story-context id="3-5-submission-tracking-github-links-and-notes" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>5</storyId>
    <title>Submission Tracking - GitHub Links and Notes</title>
    <status>ready-for-dev</status>
    <generatedAt>2026-02-04</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/3-5-submission-tracking-github-links-and-notes.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>job seeker</asA>
    <iWant>to record my assessment submission with GitHub links or notes</iWant>
    <soThat>I have a record of what I submitted and when</soThat>
    <tasks>
      <task id="1" name="Create submission API endpoints" acs="5,6,7">
        <subtask id="1.1">Create POST /api/assessments/:id/submissions endpoint in backend/internal/handlers/assessment.go</subtask>
        <subtask id="1.2">Add CreateSubmissionRequest struct with validation: submission_type (required, oneof=github,notes), github_url (optional), notes (optional)</subtask>
        <subtask id="1.3">Implement handler logic: validate assessment ownership, create submission with submitted_at timestamp</subtask>
        <subtask id="1.4">Register route in backend/internal/routes/assessment.go</subtask>
        <subtask id="1.5">Add CreateSubmission method to assessment_submission repository (already exists - verify and use)</subtask>
      </task>
      <task id="2" name="Create frontend submission service functions" acs="5">
        <subtask id="2.1">Verify AssessmentSubmission type exists in frontend/src/services/assessment-service.ts</subtask>
        <subtask id="2.2">Add createSubmission(assessmentId: string, data: CreateSubmissionRequest) function</subtask>
        <subtask id="2.3">Add CreateSubmissionRequest type: { submission_type: SubmissionType; github_url?: string; notes?: string }</subtask>
        <subtask id="2.4">Add SUBMISSION_TYPE_OPTIONS constant for dropdown (GitHub, Notes only - File deferred)</subtask>
      </task>
      <task id="3" name="Create SubmissionForm component" acs="1,2,3,4,5">
        <subtask id="3.1">Create frontend/src/components/submission-form/submission-form-modal.tsx</subtask>
        <subtask id="3.2">Use shadcn Dialog for modal wrapper</subtask>
        <subtask id="3.3">Add submission type Select (GitHub, Notes options)</subtask>
        <subtask id="3.4">Conditional rendering: show URL input when GitHub selected, textarea when Notes selected</subtask>
        <subtask id="3.5">Add URL validation (client-side) - must start with http:// or https://</subtask>
        <subtask id="3.6">Add form submission handler calling createSubmission</subtask>
        <subtask id="3.7">Create barrel export frontend/src/components/submission-form/index.ts</subtask>
      </task>
      <task id="4" name="Create SubmissionList component" acs="6,7,8">
        <subtask id="4.1">Create frontend/src/components/submission-list/submission-list.tsx</subtask>
        <subtask id="4.2">Display submissions as cards with: type icon (GitHub/Notes), content, timestamp</subtask>
        <subtask id="4.3">GitHub submissions: render clickable link that opens in new tab</subtask>
        <subtask id="4.4">Notes submissions: render text content (with truncation and expand)</subtask>
        <subtask id="4.5">Sort chronologically (newest first)</subtask>
        <subtask id="4.6">Create barrel export frontend/src/components/submission-list/index.ts</subtask>
      </task>
      <task id="5" name="Integrate submission UI into assessment detail page" acs="1,6,9">
        <subtask id="5.1">Add "Add Submission" button to assessment detail page</subtask>
        <subtask id="5.2">Add state for modal open/close: isSubmissionModalOpen</subtask>
        <subtask id="5.3">Wire onSubmittedSelect callback from AssessmentStatusSelect to open submission modal (use existing showSubmissionPrompt state)</subtask>
        <subtask id="5.4">Fetch submissions when loading assessment (via GET /api/assessments/:id/details or separate endpoint)</subtask>
        <subtask id="5.5">Render SubmissionList component showing all submissions</subtask>
        <subtask id="5.6">Refresh submission list after successful submission creation</subtask>
      </task>
      <task id="6" name="Add GET endpoint for assessment with submissions" acs="6">
        <subtask id="6.1">Create GET /api/assessments/:id/details endpoint returning assessment with submissions array</subtask>
        <subtask id="6.2">Add GetAssessmentWithSubmissions repository method with JOIN query or sequential fetch</subtask>
        <subtask id="6.3">Add getAssessmentDetails(id: string) service function returning AssessmentWithSubmissions</subtask>
      </task>
      <task id="7" name="Testing and validation" acs="1-9">
        <subtask id="7.1">Test "Add Submission" button opens modal</subtask>
        <subtask id="7.2">Test GitHub type shows URL input, Notes type shows textarea</subtask>
        <subtask id="7.3">Test URL validation rejects invalid URLs</subtask>
        <subtask id="7.4">Test successful submission creates record and appears in list</subtask>
        <subtask id="7.5">Test multiple submissions can be added</subtask>
        <subtask id="7.6">Test "Submitted" status change triggers submission modal</subtask>
        <subtask id="7.7">Test GitHub links open in new tab</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">Clicking "Add Submission" button on assessment detail page opens a submission form modal</ac>
    <ac id="2">Submission form has type selector with options: GitHub, Notes (File type deferred to Story 3.6)</ac>
    <ac id="3">When GitHub type selected, form shows URL input field with format validation (must be valid URL)</ac>
    <ac id="4">When Notes type selected, form shows textarea for detailed submission description</ac>
    <ac id="5">Clicking "Save Submission" creates a submission record via POST /api/assessments/:id/submissions with automatic timestamp</ac>
    <ac id="6">Created submission appears in assessment detail view showing: type icon, GitHub link (clickable, opens in new tab), notes content, submitted timestamp</ac>
    <ac id="7">Multiple submissions can be added to the same assessment (e.g., multiple iterations or revisions)</ac>
    <ac id="8">Submission list displays chronologically (newest first)</ac>
    <ac id="9">When "Submitted" status is selected via AssessmentStatusSelect, the submission form modal opens automatically (integrates with Story 3.4's onSubmittedSelect callback)</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec-epic-3.md" title="Epic 3 Technical Specification" section="AC-3.5, Submission Endpoints" snippet="Clicking 'Add Submission' shows form with type selector (GitHub/File/Notes). GitHub type shows URL input with format validation. Notes type shows textarea. Submissions display chronologically with type, content, and timestamp." />
      <doc path="docs/tech-spec-epic-3.md" title="Epic 3 Technical Specification" section="Data Models - AssessmentSubmission" snippet="AssessmentSubmission struct with fields: id, assessment_id, submission_type (github/file_upload/notes), github_url, file_id, notes, submitted_at, created_at" />
      <doc path="docs/architecture.md" title="Architecture Document" section="Implementation Patterns" snippet="React component pattern with useState, hooks, handlers structure. API service pattern for frontend HTTP calls. Go handler pattern with repository injection." />
      <doc path="docs/architecture.md" title="Architecture Document" section="Assessment Endpoints" snippet="POST /api/assessments/:id/submissions - Add submission with {submission_type, github_url?, file_id?, notes?}" />
    </docs>
    <code>
      <artifact path="frontend/src/app/(app)/applications/[id]/assessments/[assessmentId]/page.tsx" kind="page" symbol="AssessmentDetailPage" lines="1-243" reason="Target page for submission UI integration. Contains showSubmissionPrompt state (line 54) and handleSubmittedSelect callback (lines 94-99) ready for Story 3.5 implementation." />
      <artifact path="frontend/src/services/assessment-service.ts" kind="service" symbol="assessment-service" lines="1-144" reason="Existing service with SubmissionType, AssessmentSubmission interface. Add createSubmission function and SUBMISSION_TYPE_OPTIONS constant here." />
      <artifact path="frontend/src/components/assessment-status-select/assessment-status-select.tsx" kind="component" symbol="AssessmentStatusSelect" reason="Component with onSubmittedSelect callback prop that triggers when 'submitted' status is selected. Story 3.5 must wire this to open submission modal." />
      <artifact path="backend/internal/handlers/assessment.go" kind="handler" symbol="AssessmentHandler" lines="1-284" reason="Add CreateSubmission handler method here. Follow existing CreateAssessment pattern with request validation and repository call." />
      <artifact path="backend/internal/routes/assessment.go" kind="routes" symbol="RegisterAssessmentRoutes" lines="1-25" reason="Register new POST /:id/submissions route for submission creation endpoint." />
      <artifact path="backend/internal/repository/assessment_submission.go" kind="repository" symbol="AssessmentSubmissionRepository" lines="1-88" reason="Repository with CreateSubmission and ListByAssessmentID methods already implemented. Use existing CreateSubmission method." />
      <artifact path="backend/internal/models/assessment.go" kind="model" symbol="AssessmentSubmission" lines="50-64" reason="Model struct with all fields needed: ID, AssessmentID, SubmissionType, GithubURL, FileID, Notes, SubmittedAt, CreatedAt, DeletedAt" />
      <artifact path="backend/migrations/000009_create_assessment_system.up.sql" kind="migration" symbol="assessment_submissions" lines="16-32" reason="Database table schema for submissions. Columns: id, assessment_id, submission_type, github_url, file_id, notes, submitted_at, created_at, deleted_at" />
    </code>
    <dependencies>
      <frontend>
        <dep name="next" version="14.2.15" />
        <dep name="react" version="^18" />
        <dep name="react-hook-form" version="^7.54.2" />
        <dep name="zod" version="^3.24.2" />
        <dep name="@hookform/resolvers" version="^4.1.2" />
        <dep name="@radix-ui/react-dialog" version="^1.1.2" />
        <dep name="@radix-ui/react-select" version="^2.2.6" />
        <dep name="lucide-react" version="^0.452.0" />
        <dep name="sonner" version="^2.0.7" />
        <dep name="date-fns" version="^4.1.0" />
        <dep name="axios" version="^1.7.9" />
      </frontend>
      <backend>
        <dep name="github.com/gin-gonic/gin" version="v1.10.1" />
        <dep name="github.com/jmoiron/sqlx" version="v1.4.0" />
        <dep name="github.com/google/uuid" version="v1.6.0" />
        <dep name="github.com/lib/pq" version="v1.10.9" />
      </backend>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="scope">File upload type is OUT OF SCOPE - deferred to Story 3.6. Only implement GitHub and Notes submission types.</constraint>
    <constraint type="pattern">Follow existing component folder structure: components/{component-name}/{component-name}.tsx + index.ts barrel export</constraint>
    <constraint type="pattern">Use shadcn/ui Dialog for modal, Select for type dropdown, Input for URL, Textarea for notes</constraint>
    <constraint type="pattern">Optimistic UI updates with error rollback - update UI immediately, revert on API error</constraint>
    <constraint type="pattern">Use sonner toast for success/error notifications (toast.success, toast.error)</constraint>
    <constraint type="validation">GitHub URL validation is client-side format check only (valid URL structure). Do not verify repo exists per tech-spec assumption A3.</constraint>
    <constraint type="backend">Follow existing handler pattern: parse request, validate with binding tags, verify ownership, call repository, return response</constraint>
    <constraint type="backend">Use existing AssessmentSubmissionRepository.CreateSubmission method - no new repository code needed</constraint>
    <constraint type="api">POST /api/assessments/:id/submissions with body: {submission_type, github_url?, notes?} returns 201 with submission object</constraint>
  </constraints>

  <interfaces>
    <interface name="POST /api/assessments/:id/submissions" kind="REST endpoint" signature="POST /api/assessments/:id/submissions { submission_type: 'github' | 'notes', github_url?: string, notes?: string } → { data: { submission: AssessmentSubmission } }" path="backend/internal/handlers/assessment.go" />
    <interface name="GET /api/assessments/:id/details" kind="REST endpoint" signature="GET /api/assessments/:id/details → { data: { assessment: Assessment, submissions: AssessmentSubmission[] } }" path="backend/internal/handlers/assessment.go" />
    <interface name="createSubmission" kind="function" signature="createSubmission(assessmentId: string, data: CreateSubmissionRequest): Promise&lt;AssessmentSubmission&gt;" path="frontend/src/services/assessment-service.ts" />
    <interface name="getAssessmentDetails" kind="function" signature="getAssessmentDetails(id: string): Promise&lt;AssessmentWithSubmissions&gt;" path="frontend/src/services/assessment-service.ts" />
    <interface name="SubmissionFormModal" kind="component" signature="SubmissionFormModal({ open, onOpenChange, assessmentId, onSuccess }: Props)" path="frontend/src/components/submission-form/submission-form-modal.tsx" />
    <interface name="SubmissionList" kind="component" signature="SubmissionList({ submissions }: { submissions: AssessmentSubmission[] })" path="frontend/src/components/submission-list/submission-list.tsx" />
  </interfaces>

  <tests>
    <standards>Manual testing via dev server for frontend (per project standards). Backend follows existing handler test patterns but not required for this story. Focus on integration testing through UI.</standards>
    <locations>
      <location>frontend/src/components/submission-form/</location>
      <location>frontend/src/components/submission-list/</location>
      <location>frontend/src/app/(app)/applications/[id]/assessments/[assessmentId]/page.tsx</location>
      <location>backend/internal/handlers/assessment.go</location>
    </locations>
    <ideas>
      <idea ac="1">"Add Submission" button opens modal - verify Dialog opens with form visible</idea>
      <idea ac="2">Type selector shows GitHub and Notes options (not File) - verify Select renders correct options</idea>
      <idea ac="3">GitHub selected shows URL input with validation - test invalid URLs rejected (no protocol, invalid format)</idea>
      <idea ac="4">Notes selected shows textarea - verify conditional rendering switches between URL input and textarea</idea>
      <idea ac="5">Save creates submission via API - verify POST request sent with correct payload and 201 response</idea>
      <idea ac="6">Submission appears in list with correct display - verify type icon, clickable link (target="_blank"), timestamp format</idea>
      <idea ac="7">Multiple submissions can be added - verify list grows, new submissions appear at top</idea>
      <idea ac="8">List sorted newest first - verify submitted_at DESC order maintained</idea>
      <idea ac="9">Status "Submitted" triggers modal - change status to submitted, verify modal opens automatically</idea>
    </ideas>
  </tests>
</story-context>
