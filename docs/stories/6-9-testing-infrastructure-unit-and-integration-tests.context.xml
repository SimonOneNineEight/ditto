<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>6</epicId>
    <storyId>9</storyId>
    <title>Testing Infrastructure - Unit and Integration Tests</title>
    <status>drafted</status>
    <generatedAt>2026-02-19</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/6-9-testing-infrastructure-unit-and-integration-tests.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a developer</asA>
    <iWant>comprehensive test coverage for critical features</iWant>
    <soThat>we can confidently make changes without breaking existing functionality</soThat>
    <tasks>
      <task id="1" acs="1,2">Backend — Verify and enhance test database infrastructure
        <subtask id="1.1">Verify internal/testutil/ has working test database setup with SetupTestDB() and TeardownTestDB() helpers; if incomplete, create missing helpers</subtask>
        <subtask id="1.2">Verify migrations apply cleanly to test database (all migrations 000001–latest); fix any migration issues</subtask>
        <subtask id="1.3">Add test fixture factories for all core entities: CreateTestUser(), CreateTestApplication(), CreateTestInterview(), CreateTestAssessment(), CreateTestFile(), CreateTestNotification() — reuse existing factories where available</subtask>
        <subtask id="1.4">go build ./... passes</subtask>
      </task>
      <task id="2" acs="1">Backend — Unit tests for repository layer
        <subtask id="2.1">Write unit tests for user_repository.go — cover: CreateUser, GetUserByEmail, GetUserByID, user not found, duplicate email</subtask>
        <subtask id="2.2">Write unit tests for application_repository.go — cover: Create, GetByID, List (with filters), Update, SoftDelete, GetStatistics; test user-scoping</subtask>
        <subtask id="2.3">Write unit tests for interview_repository.go — cover: Create, GetByID, ListByApplication, Update, SoftDelete, GetWithContext; test auto-increment round_number</subtask>
        <subtask id="2.4">Write unit tests for assessment_repository.go — cover: Create, GetByID, ListByApplication, Update, UpdateStatus, SoftDelete; test status transitions</subtask>
        <subtask id="2.5">Write unit tests for file_repository.go — cover: Create, GetByID, ConfirmUpload, SoftDelete, GetStorageStats; test storage quota</subtask>
        <subtask id="2.6">Write unit tests for search_repository.go — cover: Search with valid query, empty query rejection, results grouped by type, user-scoping</subtask>
        <subtask id="2.7">Write unit tests for notification_repository.go — cover: Create, List (filter read/unread), MarkAsRead, MarkAllRead</subtask>
        <subtask id="2.8">Use table-driven test patterns for comprehensive coverage</subtask>
        <subtask id="2.9">Run go test -cover ./internal/repository/... — verify >70% coverage; fill gaps</subtask>
        <subtask id="2.10">go test ./... passes</subtask>
      </task>
      <task id="3" acs="2">Backend — Integration tests for critical endpoints
        <subtask id="3.1">Create test HTTP server setup helper that initializes Gin router with all routes, middleware, and a test database connection</subtask>
        <subtask id="3.2">Write auth endpoint integration tests — POST /api/users, POST /api/login, POST /api/refresh_token, POST /api/logout, GET /api/me</subtask>
        <subtask id="3.3">Write applications endpoint integration tests — CRUD + filters + stats</subtask>
        <subtask id="3.4">Write interviews endpoint integration tests — CRUD + round_number auto-increment</subtask>
        <subtask id="3.5">Write assessments endpoint integration tests — CRUD + status workflow + submissions</subtask>
        <subtask id="3.6">Test authorization: verify 401 for missing token, 403 for accessing another user's resources</subtask>
        <subtask id="3.7">Test validation: verify 400 for missing required fields with structured error response</subtask>
        <subtask id="3.8">go test ./... passes</subtask>
      </task>
      <task id="4" acs="3,5">Frontend — Set up Jest + React Testing Library
        <subtask id="4.1">Install test dependencies: jest, jest-environment-jsdom, @testing-library/react, @testing-library/jest-dom, @testing-library/user-event, ts-jest or @swc/jest</subtask>
        <subtask id="4.2">Create jest.config.ts with jsdom environment, module name mapping for @/ path aliases, setup file, CSS/asset mock transforms</subtask>
        <subtask id="4.3">Create jest.setup.ts with @testing-library/jest-dom import and NextAuth session mock helpers</subtask>
        <subtask id="4.4">Add "test": "jest" script to package.json (or verify existing)</subtask>
        <subtask id="4.5">Create a smoke test to verify the test setup works end-to-end</subtask>
        <subtask id="4.6">pnpm test passes with the smoke test</subtask>
      </task>
      <task id="5" acs="3">Frontend — Component tests for key user flows
        <subtask id="5.1">Write login form tests — renders form fields, validates required fields, shows error on invalid credentials, successful login redirects, OAuth buttons render</subtask>
        <subtask id="5.2">Write create application form tests — renders all form fields, Zod validation errors, successful submission, URL extraction trigger, loading state</subtask>
        <subtask id="5.3">Write interview form tests — renders modal with all fields, validates required fields, successful creation, round number auto-filled</subtask>
        <subtask id="5.4">Write assessment form tests — renders form fields, validates required fields, successful creation, date picker interaction</subtask>
        <subtask id="5.5">Mock API calls using jest.mock('@/lib/axios') or lightweight MSW; mock next-auth/react useSession</subtask>
        <subtask id="5.6">pnpm test passes with all component tests</subtask>
      </task>
      <task id="6" acs="4,5">Verify all tests pass and document
        <subtask id="6.1">Run go test ./... -v -cover — all pass, report coverage</subtask>
        <subtask id="6.2">Run pnpm test -- --coverage — all pass, report coverage</subtask>
        <subtask id="6.3">pnpm run build passes with no TypeScript errors</subtask>
        <subtask id="6.4">go build ./... passes with no Go compilation errors</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1">Backend unit tests for repository layer with >70% coverage — Repository layer (Go) has unit tests with table-driven test patterns and >70% coverage goal, covering all CRUD operations and edge cases for core repositories (NFR-5.3)</ac>
    <ac id="2">Backend integration tests for critical endpoints — Integration tests exist for auth (login, register, logout, refresh, OAuth), applications CRUD, interviews CRUD, and assessments CRUD endpoints, testing full HTTP handler to repository to database flow</ac>
    <ac id="3">Frontend component tests for key user flows — Jest + React Testing Library component tests cover login form, create application form, log interview form, and add assessment form with mocked API calls</ac>
    <ac id="4">All tests pass before deployment — Both go test ./... and pnpm test exit with zero failures and no skipped critical tests</ac>
    <ac id="5">Tests runnable via single command — Backend tests run via go test ./... and frontend tests run via pnpm test with no manual setup required beyond environment variables</ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec-epic-6.md" title="Epic 6 Tech Spec" section="Story 6.9: Testing Infrastructure" snippet="Authoritative ACs: >70% backend unit tests, integration tests for auth/apps/interviews/assessments, frontend component tests for key flows." />
      <doc path="docs/tech-spec-epic-6.md" title="Epic 6 Tech Spec" section="Test Strategy Summary" snippet="Unit, integration, and component test strategy with coverage targets per layer: repo >70%, Zod schemas 90%, hooks 80%." />
      <doc path="docs/tech-spec-epic-6.md" title="Epic 6 Tech Spec" section="Dependencies" snippet="New testing devDependencies: jest, jest-environment-jsdom, @testing-library/react, @testing-library/jest-dom. Backend has testify v1.10.0 already." />
      <doc path="docs/architecture-backend.md" title="Backend Architecture" section="Testing Strategy" snippet="Test DB ditto_test, testutil helpers (NewTestDatabase, Truncate), table-driven test patterns, fixture factories (CreateTestUser, CreateTestCompany)." />
      <doc path="docs/architecture-backend.md" title="Backend Architecture" section="Architecture Pattern" snippet="Layered: Handler → Repository → Database. Unit tests target repository in isolation; integration tests target handlers with real test DB." />
      <doc path="docs/architecture-backend.md" title="Backend Architecture" section="Error Handling" snippet="Custom AppError with ErrorCode. pkg/errors/ defines codes: ErrorBadRequest, ErrorUnauthorized, ErrorNotFound, ErrorValidationFailed, etc." />
      <doc path="docs/architecture-frontend.md" title="Frontend Architecture" section="Known Limitations" snippet="No Automated Testing: No unit, integration, or E2E tests configured — first limitation listed. Jest + RTL is the recommended setup." />
      <doc path="docs/architecture-frontend.md" title="Frontend Architecture" section="Form State" snippet="react-hook-form + Zod for validation. Schemas in frontend/src/lib/schemas/. Component tests should verify validation errors render correctly." />
      <doc path="docs/architecture-frontend.md" title="Frontend Architecture" section="API Client" snippet="Axios with request interceptor (token injection) and response interceptor (401 refresh, error toasts). Component tests should mock entire module." />
      <doc path="docs/database-schema.md" title="Database Schema" section="Core Tables" snippet="11 core tables with UUID PKs, soft deletes via deleted_at, auto-timestamps via triggers. Used for test fixture design and assertion validation." />
      <doc path="docs/api-contracts-backend.md" title="API Reference" section="All Endpoints" snippet="30+ REST endpoints: auth (5), companies (8), jobs (7), applications (10). Integration tests target auth, applications, interviews, assessments." />
      <doc path="docs/development-guide.md" title="Development Guide" section="Testing" snippet="Backend: go test ./..., Frontend: pnpm test. Test DB auto-setup with migrations. Coverage via go test -cover and jest --coverage." />
      <doc path="docs/stories/6-8-session-management-and-token-refresh.md" title="Story 6.8 (Previous)" section="Dev Agent Record" snippet="Auth refresh flow uses dual-layer token refresh. Token rotation must be tested. Logout clears DB refresh token. Access TTL 24h, Refresh TTL 7d." />
    </docs>
    <code>
      <!-- Backend Test Infrastructure -->
      <file path="backend/internal/testutil/database.go" kind="test-helper" symbol="NewTestDatabase, RunMigrations, Truncate, Close" lines="1-249" reason="Core test DB setup; all repo/handler tests depend on this. Creates connection to ditto_test, runs DDL migrations, provides cleanup." />
      <file path="backend/internal/testutil/fixtures.go" kind="test-helper" symbol="CreateTestUser, CreateTestUserAuth, CreateTestUserWithAuth, CreateTestCompany, CreateTestJob, CreateTestApplication, CreateTestInterview, CreateTestAssessment" lines="1-172" reason="Fixture factories for all entity types. Includes pointer helpers (StringPtr, Float64Ptr, IntPtr, BoolPtr)." />

      <!-- Backend Repositories (need unit tests) -->
      <file path="backend/internal/repository/application.go" kind="repository" symbol="ApplicationRepository — Create, GetByID, Update, SoftDelete, GetsByUser, GetStats" lines="1-634" reason="NO test file exists — needs unit tests for AC 1. Largest untested repository." />
      <file path="backend/internal/repository/interview.go" kind="repository" symbol="InterviewRepository — Create, GetNextRoundNumber, GetByID, Update, SoftDelete, GetByApp, GetByUser" lines="1-386" reason="NO test file exists — needs unit tests for AC 1. Tests must verify round_number auto-increment." />
      <file path="backend/internal/repository/notification_repository.go" kind="repository" symbol="NotificationRepository — Create, List, MarkAsRead, MarkAllRead" reason="NO test file exists — needs unit tests for AC 1." />
      <file path="backend/internal/repository/search_repository.go" kind="repository" symbol="SearchRepository — Search with user-scoping" reason="NO test file exists — needs unit tests for AC 1." />

      <!-- Existing Backend Tests (reference patterns) -->
      <file path="backend/internal/repository/user_test.go" kind="test" symbol="TestUserRepository — CreateUser, GetByEmail, GetByID, DuplicateEmail" lines="1-154" reason="Existing user repo tests — reference pattern for new tests." />
      <file path="backend/internal/repository/assessment_test.go" kind="test" symbol="TestAssessmentRepository — CRUD, status, submissions, cross-user" lines="1-408" reason="Existing assessment repo tests — comprehensive reference with table-driven sub-tests." />
      <file path="backend/internal/repository/file_test.go" kind="test" symbol="TestFileRepository — CRUD, storage usage, security cross-user" lines="1-501" reason="Existing file repo tests — reference for user-scoping tests." />
      <file path="backend/internal/repository/company_test.go" kind="test" symbol="TestCompanyRepository — CRUD, fuzzy search, pagination" lines="1-190" reason="Existing company repo tests." />
      <file path="backend/internal/repository/job_test.go" kind="test" symbol="TestJobRepositoryBasics — CRUD, filtering, counting" lines="1-197" reason="Existing job repo tests." />
      <file path="backend/internal/repository/dashboard_test.go" kind="test" symbol="TestDashboardRepository — stats, upcoming, caching" lines="1-505" reason="Existing dashboard tests — reference for table-driven patterns and caching tests." />

      <!-- Backend Handlers (need integration tests) -->
      <file path="backend/internal/handlers/auth.go" kind="handler" symbol="AuthHandler — Register, Login, Logout, RefreshToken, GetMe, OAuthLogin, DeleteAccount" lines="1-350" reason="Integration tests needed for AC 2. Auth is the highest-priority endpoint group." />
      <file path="backend/internal/handlers/application.go" kind="handler" symbol="ApplicationHandler — full CRUD, stats, status updates, quick-create" lines="1-546" reason="Integration tests needed for AC 2." />
      <file path="backend/internal/handlers/interview.go" kind="handler" symbol="InterviewHandler — CRUD, with-context, with-details" lines="1-497" reason="Integration tests needed for AC 2." />
      <file path="backend/internal/handlers/assessment.go" kind="handler" symbol="AssessmentHandler — CRUD, status, submissions" lines="1-474" reason="Integration tests needed for AC 2." />
      <file path="backend/internal/handlers/helpers.go" kind="handler" symbol="HandleError, HandleErrorWithMessage, logHandlerError" lines="1-83" reason="Error handling pattern used by all handlers. Integration tests should verify error response format." />

      <!-- Existing Handler Tests (reference patterns) -->
      <file path="backend/internal/handlers/handlers_test.go" kind="test" symbol="TestHealthEndpoint, TestUserRegistrationRequest, TestErrorResponseFormat" lines="1-421" reason="Existing mock-based handler tests — reference for test server setup with gin.TestMode." />
      <file path="backend/internal/handlers/file_test.go" kind="test" symbol="setupFileHandlerTest — real DB + S3 integration" lines="1-498" reason="Existing handler integration tests — best reference for full handler-to-DB test pattern." />

      <!-- Backend Error System -->
      <file path="backend/pkg/errors/errors.go" kind="error-types" symbol="AppError, ErrorCode, New, Wrap, IsNotFoundError" lines="1-192" reason="Error codes and constructors for integration test assertions." />
      <file path="backend/pkg/errors/convert.go" kind="error-convert" symbol="ConvertError, formatValidationFieldErrors" lines="1-99" reason="Error conversion logic. Integration tests should validate field name format in validation errors." />

      <!-- Backend Auth -->
      <file path="backend/internal/auth/jwt.go" kind="auth" symbol="GenerateToken, GenerateRefreshToken, ValidateToken; AccessTokenTTL=24h, RefreshTokenTTL=7d" lines="1-70" reason="Token generation for test authentication. Reads JWT_SECRET from env — tests must set this." />
      <file path="backend/internal/auth/hashing.go" kind="auth" symbol="HashPassword, CheckPassword; DefaultCost=12" lines="1-18" reason="Password hashing for test fixture creation." />

      <!-- Backend Middleware -->
      <file path="backend/internal/middleware/auth.go" kind="middleware" symbol="AuthMiddleware — JWT validation, sets user_id in context" lines="1-41" reason="Must be included in integration test HTTP server." />
      <file path="backend/internal/middleware/csrf.go" kind="middleware" symbol="CSRFMiddleware — token generation/validation" lines="1-142" reason="All state-changing routes require CSRF. Integration tests need to handle CSRF tokens." />
      <file path="backend/internal/middleware/error.go" kind="middleware" symbol="ErrorHandler — catches panics, converts errors to HTTP responses" lines="1-59" reason="Error middleware required in test HTTP server for proper error formatting." />

      <!-- Backend Routes -->
      <file path="backend/internal/routes/auth.go" kind="routes" symbol="RegisterAuthRoutes" reason="Route setup for integration test server. Public: POST /users, /login, /refresh_token, /oauth. Protected: POST /logout, GET /me." />
      <file path="backend/internal/routes/application.go" kind="routes" symbol="RegisterApplicationRoutes" reason="Route setup for integration test server. All under /applications with auth+CSRF." />
      <file path="backend/internal/routes/interview.go" kind="routes" symbol="RegisterInterviewRoutes" reason="Route setup for integration test server." />
      <file path="backend/internal/routes/assessment.go" kind="routes" symbol="RegisterAssessmentRoutes" reason="Route setup for integration test server." />

      <!-- Backend Models -->
      <file path="backend/internal/models/user.go" kind="model" symbol="User, UserAuth" lines="1-32" reason="Model structs for fixture factories and test assertions." />
      <file path="backend/internal/models/application.go" kind="model" symbol="Application, ApplicationStatus" lines="1-36" reason="Model structs for application test data." />
      <file path="backend/internal/models/interview.go" kind="model" symbol="Interview, Interviewer, InterviewQuestion, InterviewNote; 6 type constants" lines="1-94" reason="Model structs with type constants for interview test data." />
      <file path="backend/internal/models/assessment.go" kind="model" symbol="Assessment, AssessmentSubmission; 6 assessment types, 5 statuses, 3 submission types" lines="1-65" reason="Model structs with type/status constants for assessment test data." />
      <file path="backend/internal/models/file.go" kind="model" symbol="File" lines="1-30" reason="File model for storage/upload test data." />

      <!-- Frontend Forms (need component tests) -->
      <file path="frontend/src/app/(auth)/login/page.tsx" kind="page" symbol="LoginForm — Zod loginSchema, data-testid attributes, signIn('credentials')" lines="1-164" reason="Login form component test target for AC 3. Has data-testid attributes for easy querying." />
      <file path="frontend/src/app/(app)/applications/new/add-application-form.tsx" kind="component" symbol="AddApplicationForm — applicationSchema, company picker, URL extraction" reason="Application form test target for AC 3." />
      <file path="frontend/src/components/interview-form/interview-form-modal.tsx" kind="component" symbol="InterviewFormModal — interviewFormSchema, Dialog wrapper" reason="Interview form test target for AC 3." />
      <file path="frontend/src/components/assessment-form/assessment-form-modal.tsx" kind="component" symbol="AssessmentFormModal — assessmentSchema, date picker" reason="Assessment form test target for AC 3." />

      <!-- Frontend Schemas -->
      <file path="frontend/src/lib/schemas/application.ts" kind="schema" symbol="applicationSchema, companySchema, urlImportSchema, ApplicationFormData" lines="1-30" reason="Zod validation rules for application form tests." />
      <file path="frontend/src/lib/schemas/interview.ts" kind="schema" symbol="interviewFormSchema, addRoundSchema, InterviewFormData" lines="1-29" reason="Zod validation rules for interview form tests." />
      <file path="frontend/src/lib/schemas/assessment.ts" kind="schema" symbol="assessmentSchema, AssessmentFormData" lines="1-26" reason="Zod validation rules for assessment form tests." />
      <file path="frontend/src/lib/schemas/submission.ts" kind="schema" symbol="submissionSchema with refinements, SubmissionFormData" lines="1-54" reason="Submission validation with conditional rules for type-specific tests." />

      <!-- Frontend Infrastructure -->
      <file path="frontend/src/lib/axios.ts" kind="api-client" symbol="api instance, request/response interceptors, retry logic, refresh queue" lines="1-157" reason="Must mock entirely in component tests to avoid interceptor side effects." />
      <file path="frontend/src/auth.ts" kind="auth-config" symbol="NextAuth config, refreshAccessToken, providers, callbacks" lines="1-152" reason="Mock next-auth/react useSession in component tests." />
      <file path="frontend/src/providers/auth-provider.tsx" kind="provider" symbol="AuthProvider — SessionProvider wrapper" lines="1-16" reason="Wraps test components in SessionProvider context." />
      <file path="frontend/src/types/auth-type.ts" kind="types" symbol="LoginResponse, UserResponse, NextAuth module augmentation" reason="Types for constructing mock session data in tests." />
      <file path="frontend/package.json" kind="config" symbol="scripts, dependencies, devDependencies" lines="1-76" reason="Must add test script and jest/RTL devDependencies. Currently has NO test framework." />
    </code>
    <dependencies>
      <ecosystem name="go" version="1.24.0">
        <package name="github.com/gin-gonic/gin" version="v1.10.1" />
        <package name="github.com/jmoiron/sqlx" version="v1.4.0" />
        <package name="github.com/lib/pq" version="v1.10.9" />
        <package name="github.com/stretchr/testify" version="v1.10.0" />
        <package name="github.com/golang-jwt/jwt/v5" version="v5.2.2" />
        <package name="github.com/go-playground/validator/v10" version="v10.26.0" />
        <package name="github.com/google/uuid" version="v1.6.0" />
        <package name="golang.org/x/crypto" version="v0.44.0" />
        <package name="github.com/golang-migrate/migrate/v4" version="v4.18.3" />
        <package name="github.com/microcosm-cc/bluemonday" version="v1.0.27" />
        <package name="github.com/gin-contrib/cors" version="v1.7.6" />
        <package name="github.com/aws/aws-sdk-go-v2" version="v1.41.0" />
      </ecosystem>
      <ecosystem name="node" version="18+">
        <package name="next" version="14.2.15" />
        <package name="react" version="^18" />
        <package name="typescript" version="^5" />
        <package name="zod" version="^3.24.2" />
        <package name="react-hook-form" version="^7.54.2" />
        <package name="@hookform/resolvers" version="^4.1.2" />
        <package name="axios" version="^1.7.9" />
        <package name="next-auth" version="5.0.0-beta.29" />
        <package name="sonner" version="^2.0.7" />
        <package name="tailwindcss" version="^4.1.10" />
        <package name="eslint" version="^8" />
        <package name="prettier" version="^3.5.2" />
        <new-dev-dependency name="jest" />
        <new-dev-dependency name="jest-environment-jsdom" />
        <new-dev-dependency name="@testing-library/react" />
        <new-dev-dependency name="@testing-library/jest-dom" />
        <new-dev-dependency name="@testing-library/user-event" />
        <new-dev-dependency name="ts-jest" note="or @swc/jest for faster compilation" />
        <new-dev-dependency name="@types/jest" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Table-driven tests: All backend unit tests MUST use []struct{name, input, want} pattern with t.Run (per tech spec and existing conventions)</constraint>
    <constraint>Real test database: Repository tests use testutil.NewTestDatabase(t) with real PostgreSQL ditto_test DB — no mocks for DB layer</constraint>
    <constraint>User-scoping: All repository queries filter by user_id; tests must verify user A cannot access user B's resources</constraint>
    <constraint>Soft deletes: Tests must verify that soft-deleted records are excluded from query results</constraint>
    <constraint>Error codes: Integration tests should validate structured error responses with AppError.Code values from pkg/errors/errors.go</constraint>
    <constraint>CSRF middleware: All state-changing routes (POST/PUT/PATCH/DELETE) require CSRF token; integration tests must handle CSRF token acquisition and submission</constraint>
    <constraint>JWT_SECRET env: Auth tests require JWT_SECRET and JWT_REFRESH_SECRET environment variables to be set (use t.Setenv for test isolation)</constraint>
    <constraint>No mock interfaces for repositories: Project uses real DB connections for repository tests, not mock interfaces (follow existing pattern)</constraint>
    <constraint>Frontend mock axios: Component tests must jest.mock('@/lib/axios') to avoid interceptor side effects (token refresh, toasts, retries)</constraint>
    <constraint>Frontend mock next-auth: Component tests must mock next-auth/react to provide useSession with authenticated session data</constraint>
    <constraint>Frontend no test infrastructure exists: Jest + RTL must be installed from scratch as devDependencies; jest.config.ts and jest.setup.ts must be created</constraint>
    <constraint>Validation field names: Backend formatValidationFieldErrors() uses PascalCase field names — integration tests should verify field name format</constraint>
    <constraint>Token rotation: Refresh token integration tests must verify the old refresh token is invalidated after use (rotated)</constraint>
    <constraint>Existing test patterns: Follow patterns established in assessment_test.go (table-driven), file_test.go (handler integration with real DB), and handlers_test.go (mock-based unit)</constraint>
  </constraints>

  <interfaces>
    <interface name="Register" kind="REST POST" signature="POST /api/users — {email, name, password} → {user, access_token, refresh_token}" path="backend/internal/handlers/auth.go" />
    <interface name="Login" kind="REST POST" signature="POST /api/login — {email, password} → {user, access_token, refresh_token}" path="backend/internal/handlers/auth.go" />
    <interface name="Logout" kind="REST POST" signature="POST /api/logout — Bearer token → clears refresh_token in DB" path="backend/internal/handlers/auth.go" />
    <interface name="RefreshToken" kind="REST POST" signature="POST /api/refresh_token — {refresh_token} → {access_token, refresh_token, expires_in}" path="backend/internal/handlers/auth.go" />
    <interface name="GetMe" kind="REST GET" signature="GET /api/me — Bearer token → {id, email, name}" path="backend/internal/handlers/auth.go" />
    <interface name="DeleteAccount" kind="REST DELETE" signature="DELETE /api/users/account — Bearer token → 204 No Content" path="backend/internal/handlers/auth.go" />
    <interface name="CreateApplication" kind="REST POST" signature="POST /api/applications — {company_name, position, status, ...} → Application" path="backend/internal/handlers/application.go" />
    <interface name="ListApplications" kind="REST GET" signature="GET /api/applications?status=&amp;page=&amp;limit= → {applications, total, page}" path="backend/internal/handlers/application.go" />
    <interface name="GetApplication" kind="REST GET" signature="GET /api/applications/:id → Application" path="backend/internal/handlers/application.go" />
    <interface name="UpdateApplication" kind="REST PUT" signature="PUT /api/applications/:id — Application fields → updated Application" path="backend/internal/handlers/application.go" />
    <interface name="DeleteApplication" kind="REST DELETE" signature="DELETE /api/applications/:id → 204 soft delete" path="backend/internal/handlers/application.go" />
    <interface name="ApplicationStats" kind="REST GET" signature="GET /api/applications/stats → {status_counts}" path="backend/internal/handlers/application.go" />
    <interface name="CreateInterview" kind="REST POST" signature="POST /api/interviews — {application_id, interview_type, scheduled_date, ...} → Interview" path="backend/internal/handlers/interview.go" />
    <interface name="GetInterview" kind="REST GET" signature="GET /api/interviews/:id → Interview" path="backend/internal/handlers/interview.go" />
    <interface name="UpdateInterview" kind="REST PUT" signature="PUT /api/interviews/:id — fields → updated Interview" path="backend/internal/handlers/interview.go" />
    <interface name="DeleteInterview" kind="REST DELETE" signature="DELETE /api/interviews/:id → 204 soft delete" path="backend/internal/handlers/interview.go" />
    <interface name="CreateAssessment" kind="REST POST" signature="POST /api/assessments — {application_id, assessment_type, title, due_date, ...} → Assessment" path="backend/internal/handlers/assessment.go" />
    <interface name="UpdateAssessmentStatus" kind="REST PATCH" signature="PATCH /api/assessments/:id/status — {status} → updated Assessment" path="backend/internal/handlers/assessment.go" />
    <interface name="CreateSubmission" kind="REST POST" signature="POST /api/assessments/:id/submissions — {submission_type, github_url|file_id|notes} → Submission" path="backend/internal/handlers/assessment.go" />
    <interface name="ErrorResponse" kind="JSON" signature="{error: {code: ErrorCode, message: string}}" path="backend/pkg/errors/errors.go" />
  </interfaces>

  <tests>
    <standards>Backend tests use Go stdlib testing + testify assertions (assert, require). Repository unit tests run against real PostgreSQL test database (ditto_test) via testutil.NewTestDatabase(t) with inline DDL migrations and Truncate cleanup. Table-driven patterns with t.Run for comprehensive coverage. Handler integration tests use gin.TestMode + httptest.NewRecorder() with real Gin router and test DB. Frontend component tests (new) will use Jest with jsdom environment and React Testing Library for DOM-based assertions, mocking next-auth/react for session and @/lib/axios for API calls.</standards>
    <locations>
      <loc>backend/internal/repository/*_test.go</loc>
      <loc>backend/internal/handlers/*_test.go</loc>
      <loc>backend/internal/middleware/*_test.go</loc>
      <loc>backend/internal/services/**/*_test.go</loc>
      <loc>backend/internal/testutil/</loc>
      <loc>frontend/src/**/*.test.tsx</loc>
      <loc>frontend/src/**/*.test.ts</loc>
      <loc>frontend/jest.config.ts</loc>
      <loc>frontend/jest.setup.ts</loc>
    </locations>
    <ideas>
      <idea ac="1">application_test.go: table-driven tests for CreateApplication (valid, missing fields), GetByID (found, not found, wrong user), List with filters (status, date, pagination), Update, SoftDelete, GetStats by status, user-scoping isolation</idea>
      <idea ac="1">interview_test.go: table-driven tests for Create (valid, auto-increment round_number), GetByID (found, not found, wrong user), ListByApplication (sorted), Update, SoftDelete, GetWithContext (previous rounds)</idea>
      <idea ac="1">notification_test.go: Create, List (filter read/unread), MarkAsRead (single), MarkAllRead, user-scoping</idea>
      <idea ac="1">search_test.go: Search with valid query, empty query rejection, results grouped by type, user-scoping</idea>
      <idea ac="2">auth integration: POST /api/users (register valid, duplicate email 409), POST /api/login (valid, wrong password 401, nonexistent 401), POST /api/refresh_token (valid rotation, expired 401), POST /api/logout (clears DB token), GET /api/me (valid, no token 401)</idea>
      <idea ac="2">applications integration: POST /api/applications (create valid, missing fields 400), GET (list with filters), GET /:id (found, not found 404, wrong user 404), PUT (update), DELETE (soft delete), GET /stats</idea>
      <idea ac="2">interviews integration: POST (create, round_number auto-increment), GET /:id, PUT, DELETE; verify 401/403 for auth/authz</idea>
      <idea ac="2">assessments integration: POST (create), PATCH /:id/status (valid transitions), POST /:id/submissions (github, notes); verify structured validation errors</idea>
      <idea ac="3">Login form: renders email/password, shows Zod errors (empty fields, invalid email), calls signIn on valid submit (mocked), shows error toast on failure, OAuth buttons present</idea>
      <idea ac="3">Application form: renders all fields, shows Zod errors on invalid input, successful POST (mocked axios), URL extraction trigger, loading/disabled state during submit</idea>
      <idea ac="3">Interview form: renders modal with type/date fields, validates required fields, successful POST (mocked), round number auto-populated</idea>
      <idea ac="3">Assessment form: renders type/title/due_date fields, validates required fields, successful POST (mocked), date picker interaction</idea>
      <idea ac="4,5">Final verification: go test ./... -v -cover exits 0 with >70% repo coverage; pnpm test exits 0; pnpm build and go build pass</idea>
    </ideas>
  </tests>
</story-context>
