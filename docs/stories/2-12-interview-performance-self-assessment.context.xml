<story-context id="2-12-interview-performance-self-assessment" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>12</storyId>
    <title>Interview Performance Self-Assessment</title>
    <status>drafted</status>
    <generatedAt>2026-02-02</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-12-interview-performance-self-assessment.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>job seeker</asA>
    <iWant>add my own performance assessment after each interview</iWant>
    <soThat>I can track how I felt I did and identify patterns over time</soThat>
    <tasks>
      <task id="1" title="Verify Existing Schema Fields">
        <subtask id="1.1">Confirm interviews table has: overall_feeling, went_well, could_improve, confidence_level</subtask>
        <subtask id="1.2">Verify UpdateInterview handler accepts these fields</subtask>
        <subtask id="1.3">Add validation for confidence_level (1-5 range) if not present</subtask>
        <subtask id="1.4">Add validation for overall_feeling enum if not present</subtask>
      </task>
      <task id="2" title="Create Self-Assessment Form Component">
        <subtask id="2.1">Create SelfAssessmentSection component in components/interview-detail/</subtask>
        <subtask id="2.2">Add to CollapsibleSection with "Self-Assessment" title</subtask>
        <subtask id="2.3">Implement overall_feeling Select dropdown</subtask>
        <subtask id="2.4">Implement went_well Textarea with auto-resize</subtask>
        <subtask id="2.5">Implement could_improve Textarea with auto-resize</subtask>
        <subtask id="2.6">Implement confidence_level Slider (1-5)</subtask>
      </task>
      <task id="3" title="Implement Auto-Save for Self-Assessment">
        <subtask id="3.1">Use existing auto-save pattern from notes section</subtask>
        <subtask id="3.2">Debounce at 30 seconds</subtask>
        <subtask id="3.3">Show "Saving..." / "Saved" indicator</subtask>
        <subtask id="3.4">Only trigger save if content changed</subtask>
        <subtask id="3.5">Handle save errors with toast notification</subtask>
      </task>
      <task id="4" title="Integrate with Interview Detail Page">
        <subtask id="4.1">Add SelfAssessmentSection to interview detail page</subtask>
        <subtask id="4.2">Pass interview data (overall_feeling, went_well, could_improve, confidence_level)</subtask>
        <subtask id="4.3">Pass onUpdate callback to refresh interview after save</subtask>
        <subtask id="4.4">Position after existing note sections</subtask>
      </task>
      <task id="5" title="Add Summary Indicator">
        <subtask id="5.1">Show summary in collapsed header if filled (e.g., "Good - 4/5")</subtask>
        <subtask id="5.2">Show empty state hint if not filled ("Rate your performance")</subtask>
      </task>
      <task id="6" title="Manual Testing">
        <subtask id="6.1">Test overall feeling selection saves and persists</subtask>
        <subtask id="6.2">Test went_well textarea auto-saves</subtask>
        <subtask id="6.3">Test could_improve textarea auto-saves</subtask>
        <subtask id="6.4">Test confidence level slider saves and persists</subtask>
        <subtask id="6.5">Test partial updates (fill only some fields)</subtask>
        <subtask id="6.6">Verify auto-save indicator shows correctly</subtask>
        <subtask id="6.7">Test refresh preserves all values</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="1" title="Self-Assessment Section Display">
      <when>I view the interview detail page</when>
      <then>I see a "Self-Assessment" collapsible section</then>
      <and>the section is collapsed by default for new interviews</and>
      <and>the section shows a summary indicator if already filled (e.g., "Good - 4/5")</and>
    </ac>
    <ac id="2" title="Overall Feeling Selection">
      <when>I expand the Self-Assessment section</when>
      <then>I see an "Overall Feeling" dropdown with options: Excellent, Good, Okay, Poor</then>
      <and>selecting a value updates the UI immediately</and>
      <and>the selection persists after page refresh</and>
    </ac>
    <ac id="3" title="What Went Well Field">
      <when>I view the Self-Assessment section</when>
      <then>I see a "What went well?" textarea</then>
      <and>I can type freely with no character limit</and>
      <and>content auto-saves after 30 seconds of inactivity</and>
      <and>a "Saving..." / "Saved" indicator shows during/after save</and>
    </ac>
    <ac id="4" title="Areas for Improvement Field">
      <when>I view the Self-Assessment section</when>
      <then>I see a "What could improve?" textarea</then>
      <and>I can type freely with no character limit</and>
      <and>content auto-saves after 30 seconds of inactivity</and>
    </ac>
    <ac id="5" title="Confidence Level Slider">
      <when>I view the Self-Assessment section</when>
      <then>I see a "Confidence Level" slider from 1-5</then>
      <and>the slider shows labels: 1 (Low) to 5 (High)</and>
      <and>selecting a value updates the UI immediately</and>
      <and>the selection persists after page refresh</and>
    </ac>
    <ac id="6" title="Backend PUT Endpoint">
      <when>I update any self-assessment field</when>
      <then>PUT /api/interviews/:id accepts: overall_feeling, went_well, could_improve, confidence_level</then>
      <and>partial updates are supported (only changed fields)</and>
      <and>200 OK is returned with updated interview</and>
      <and>validation ensures confidence_level is 1-5 if provided</and>
      <and>validation ensures overall_feeling is valid enum value if provided</and>
    </ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec-epic-2.md" title="Epic 2 Tech Spec" section="Data Models and Contracts">
        Interview entity includes self-assessment fields: overall_feeling (enum: excellent/good/okay/poor), went_well (text), could_improve (text), confidence_level (int 1-5). AC-2.12 defines self-assessment acceptance criteria.
      </doc>
      <doc path="docs/epics.md" title="Epics Overview" section="Story 2.12">
        Story definition for Interview Performance Self-Assessment - final story in Epic 2.
      </doc>
      <doc path="ditto-design.pen" title="Ditto Design File" section="SelfAssessmentCard (node: ai2w6)">
        Design reference for Self-Assessment UI. Card layout with: Overall Feeling dropdown, What went well textarea (80px height), What could improve textarea (80px height), Confidence Level 1-5 button row with selected state highlight. Uses $--card background, $--border stroke, Inter font family.
      </doc>
    </docs>
    <code>
      <file path="backend/internal/models/interview.go" kind="model" symbol="Interview" lines="26-43" reason="Interview model already includes OverallFeeling, WentWell, CouldImprove, ConfidenceLevel fields"/>
      <file path="backend/internal/handlers/interview.go" kind="handler" symbol="UpdateInterviewRequest" lines="26-32" reason="UpdateInterviewRequest struct needs to add self-assessment fields (currently missing)"/>
      <file path="backend/internal/handlers/interview.go" kind="handler" symbol="UpdateInterview" lines="177-229" reason="UpdateInterview handler needs to handle self-assessment fields in updates map"/>
      <file path="frontend/src/services/interview-service.ts" kind="service" symbol="UpdateInterviewRequest" lines="48-54" reason="Frontend UpdateInterviewRequest interface - needs self-assessment fields added"/>
      <file path="frontend/src/services/interview-service.ts" kind="service" symbol="updateInterview" lines="206-212" reason="Existing updateInterview function - already implemented, accepts partial updates"/>
      <file path="frontend/src/services/interview-service.ts" kind="service" symbol="Interview" lines="56-71" reason="Interview interface already has optional self-assessment fields"/>
      <file path="frontend/src/components/interview-detail/notes-section.tsx" kind="component" symbol="NoteSection" lines="38-164" reason="Reference for auto-save pattern: 30s debounce, autoSaveStatus state, lastSavedRef for change detection"/>
      <file path="frontend/src/components/interview-detail/collapsible-section.tsx" kind="component" symbol="CollapsibleSection" lines="26-80" reason="Reusable collapsible section component - use for Self-Assessment section wrapper"/>
      <file path="frontend/src/components/interview-detail/index.ts" kind="barrel" lines="1-7" reason="Barrel export file - add SelfAssessmentSection export"/>
      <file path="frontend/src/app/(app)/interviews/[id]/page.tsx" kind="page" symbol="InterviewDetailPage" lines="78-444" reason="Interview detail page - add SelfAssessmentSection after NoteSection (around line 310)"/>
    </code>
    <dependencies>
      <frontend>
        <package name="react" version="^18.3.0"/>
        <package name="next" version="^14.2.0"/>
        <package name="@radix-ui/react-select" note="For Select dropdown component"/>
        <package name="@radix-ui/react-slider" note="For Slider component (or use button group per design)"/>
        <package name="sonner" note="For toast notifications"/>
        <package name="lucide-react" note="For icons"/>
      </frontend>
      <backend>
        <package name="github.com/gin-gonic/gin" version="v1.10.0"/>
        <package name="gorm.io/gorm" version="v1.25.7"/>
      </backend>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="pattern">Follow existing auto-save pattern from NoteSection: 30s debounce, autoSaveStatus state (idle/saving/saved/error), lastSavedRef for change detection</constraint>
    <constraint type="pattern">Use CollapsibleSection component wrapper consistent with other sections</constraint>
    <constraint type="validation">Backend must validate confidence_level is 1-5 if provided</constraint>
    <constraint type="validation">Backend must validate overall_feeling is one of: excellent, good, okay, poor</constraint>
    <constraint type="ui">Self-assessment fields are entirely optional - user can skip completely</constraint>
    <constraint type="ui">Empty textarea values should be stored as null, not empty strings</constraint>
    <constraint type="api">Use existing PUT /api/interviews/:id endpoint - no new endpoints needed</constraint>
    <constraint type="design">Match SelfAssessmentCard design from ditto-design.pen (node ai2w6)</constraint>
  </constraints>

  <interfaces>
    <interface name="UpdateInterviewRequest (Backend)" kind="struct" path="backend/internal/handlers/interview.go">
      <signature>
type UpdateInterviewRequest struct {
    ScheduledDate   *string `json:"scheduled_date"`
    ScheduledTime   *string `json:"scheduled_time"`
    DurationMinutes *int    `json:"duration_minutes"`
    InterviewType   *string `json:"interview_type"`
    Outcome         *string `json:"outcome"`
    // ADD THESE:
    OverallFeeling  *string `json:"overall_feeling" binding:"omitempty,oneof=excellent good okay poor"`
    WentWell        *string `json:"went_well"`
    CouldImprove    *string `json:"could_improve"`
    ConfidenceLevel *int    `json:"confidence_level" binding:"omitempty,min=1,max=5"`
}
      </signature>
    </interface>
    <interface name="UpdateInterviewRequest (Frontend)" kind="interface" path="frontend/src/services/interview-service.ts">
      <signature>
export interface UpdateInterviewRequest {
    scheduled_date?: string;
    scheduled_time?: string;
    duration_minutes?: number;
    interview_type?: InterviewType;
    outcome?: string;
    // ADD THESE:
    overall_feeling?: 'excellent' | 'good' | 'okay' | 'poor';
    went_well?: string;
    could_improve?: string;
    confidence_level?: number;
}
      </signature>
    </interface>
    <interface name="PUT /api/interviews/:id" kind="REST endpoint" path="backend/internal/routes/interview.go">
      <signature>
PUT /api/interviews/:id
Authorization: Bearer {jwt_token}
Content-Type: application/json

Request (partial update):
{
  "overall_feeling": "good",
  "went_well": "Explained system design clearly...",
  "could_improve": "Could be more concise...",
  "confidence_level": 4
}

Response (200 OK):
{
  "data": {
    "interview": { ...updated interview with self-assessment fields... }
  }
}
      </signature>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Manual testing is the primary testing approach for this story. Frontend component behavior verified through browser testing. Backend validation tested via API calls. Follow existing patterns from Story 2-11 testing approach.
    </standards>
    <locations>
      <location>Manual browser testing at /interviews/:id</location>
      <location>API testing via curl or Postman for PUT /api/interviews/:id</location>
    </locations>
    <ideas>
      <idea ac="1">Verify Self-Assessment section appears collapsed by default on new interview</idea>
      <idea ac="1">Verify summary indicator shows "Good - 4/5" format when filled</idea>
      <idea ac="2">Test overall_feeling dropdown has all 4 options (Excellent, Good, Okay, Poor)</idea>
      <idea ac="2">Verify selection persists after page refresh</idea>
      <idea ac="3">Test went_well textarea auto-saves after 30s of inactivity</idea>
      <idea ac="3">Verify "Saving..." indicator appears during save</idea>
      <idea ac="3">Verify "Saved" indicator appears after successful save</idea>
      <idea ac="4">Test could_improve textarea follows same auto-save pattern</idea>
      <idea ac="5">Test confidence_level 1-5 selection with button row per design</idea>
      <idea ac="5">Verify selected confidence button is highlighted</idea>
      <idea ac="6">Test backend validation rejects confidence_level outside 1-5 range</idea>
      <idea ac="6">Test backend validation rejects invalid overall_feeling values</idea>
      <idea ac="6">Test partial updates (only update one field at a time)</idea>
    </ideas>
  </tests>
</story-context>
